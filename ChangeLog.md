# 更新日志

## 20200510

开始项目

由《网页内容变动提醒》进行拆除

## 20200511

完成主界面的框架

完成分类树形图的逻辑和显示

基本完成分类设置的匹配条件设置

## 20200512

基本完成了分类树状图的新增和删除

完成分类的重命名

基本完成对文件的枚举分类工具方法

完成文件浏览界面基本功能，包括项目的名称显示、根目录设置

基本完成使用列表视图和图标视图来显示文件。

 ## 20200513

基本完成使用图标视图时的内存分页（图标视图应该没有虚拟化，很卡）

新增树状视图

基本完成对图片缩略图的显示

## 20200514

将图标和缩略图封装为组件，并为三个视图都应用了该组件

新增列表视图支持滚轮缩放

修改了分页按钮样式

新增项目的新建

新增右键打开目录菜单

列表视图新增组合框，用于跳转到指定目录的文件位置

新增Ctrl+滚轮实现图标视图的缩放功能

重写了缩略图策略，改为在枚举文件时就获取缩略图，并使用数据库BLOB保存缩略图

过滤方式新增正则表达式相关、文件大小限制、文件修改时间限制

-----

## 20200526

将控件库从MaterialDesign改为ModernWpf，基本完成主要修改

## 20200527

完全清除了MaterialDesign库

新增对于没有缩略图的文件，根据文件类型提供不同的图标，对于文件夹提供文件夹图标

新增了单独的项目设置页

支持了图标视图根据文件夹跳转

修改了一些逻辑

为处理中Ring的覆盖层加了动画

## 20200528

新增了导出为快捷方式或副本的功能

修复了一些BUG，优化了一些功能

## 20200528

支持了导入和导出数据库（项目）的功能

支持了一键删除所有项目

## 20200601

修复了项目设置界面的布局错误

新增可以使用按钮+对话框选择根目录

修改文件浏览界面的左侧分类列表为Expander

新增错误提示框

支持了对单个类进行刷新

## 20200702

为了增加标签模式，大幅度修改了代码，对某些类和界面进行了抽象，新增了一些父类，对文件浏览块进行了封装

修改Class，从树状结构修改为顺序结构

## 20200703

标签类型的显示和管理有了一个样子，可以勉强使用了。基本完成了显示和设置界面。

新增了启动界面，因为主界面打开太慢了。

-------

## 20200703

越写越乱，于是决定再次“重构”。合并了Class和Tag，修改了不同Class同一个文件使用同一个File的设定。
一个物理文件使用一个File，File和Class使用FileClass类进行多对多连接。

没想到，一个下午+晚上，竟然把程序改到能打开并且基本功能正常的地步了。

## 20200704

修复了新建文件时，File的Dir会从\起头的BUG

修复了更新文件的一些BUG，比如文件会重复等

新增删除项目所有文件的功能

项目设置界面新增数据库记录数量的显示

新增显示全部文件按钮

修复了在项目之间快速切换会同时访问数据库导致出错的BUG（实质是Base类中记忆的问题）

修复了无法双击打开文件的BUG（在新建UIFile的时候，没有赋值Project）

列表支持了多选

新增通过右键菜单来选择和取消选择文件的类别（新增了FileClass的Disabled字段，保证重新刷新以后仍然不会被加入该类）

优化图标显示，图标大小将和缩略图大小一样支持自动缩放

修复了将文件添加到类时，会造成一个项目中多个文件对象、一个类中多个文件对象的BUG

新增在标签上按鼠标中键删除标签的功能

## 20200705

新增了更新文件对话框

将配置文件改到了数据库里

将DbUtility分离为了多个类

修复了“根据文件夹定位”不可用的BUG

新增了文件搜索框

修复了之前因数据库大改而失效的导入导出功能

修复了可能无法从类中移除文件的BUG（但至今还是不知道为什么会有多个FIleClass对应同一个File和Class）（后来知道了是我犯了一个SB错误）

## 20200706

修复了可能无法从类中移除文件的BUG（

对分类设置的用户操作做了优化，增删改之后会选中分类

输入对话框弹出后将自动获取焦点并全选

新增对添加文件夹到类的支持，并同步支持了File承载文件夹

新增了新增文件的对话框

## 20200708

新增支持在浏览是尝试自动生成缩略图

优化了文件浏览加载速度，将标签的获取修改为动态获取，大大加快了速度

新增删除项目所有缩略图功能

新增压缩数据库功能

## 20200711

新增平铺视图

修复了树状图中无法在标签上按中键的BUG

启动页面支持了根据亮色/暗色模式自动切换启动图

修复了图标视图的图标不会跟着滚轮放大缩小的BUG

## 20200712

对图标视图和平铺视图启用了虚拟化，大大加快了速度，因此取消了分页

文件浏览页面修改为ContentControl+Resouce

花了一个上午修改了居多东西，大多数是为了适配虚拟化的网格视图，不一一列举了。

## 20200713

优化了动态更新，在新的更新开始时，将会中止已经存在的更新。

新增支持了拖放文件到外部（例如资源管理器），并优化修改了部分列表的选择策略

新增支持了视频缩略图

修改缩略图的存储方式，由数据库改为文件存储，同时修改了数据库字段

修复了图片图标错误的BUG

## 20200714

新增显示资源管理器里显示的图标的功能

修复了右键菜单选择和取消选择类别失效的BUG

新增四个开关：缩略图、标签、资源管理器图标、图标视图的文件名

## 20200715

重构了UIFile，不再继承File，而是单独让File变为一个属性，同时抽象出了UIFileDisplay和UIFileSize两个类

重写了Configs类，使其更方便添加新的配置项

新增了项目、类、视图的记忆功能

新增列表显示文件大小功能

统一了列表和树状图的ItemTemplate

## 20200716

修改了实时获取缩略图的策略。由于发现FineIcon只会在需要显示时初始化，因此干脆把所有的刷新的东西写到了FileIcon中。

新增了全局错误捕捉（暂无GUI提示）

在进行耗时操作（转圈圈）时，将无法关闭窗体

支持了调整最大线程数

支持了更新文件和添加文件时生成资源管理器图标

修复了树状图文件夹在显示资源管理器图标时无法正常显示的BUG

新增支持设置平铺视图是否显示文件夹目录

调整了视图设置弹出面板的布局，并新增了缩放滑块

## 20200717

新增详细信息视图

将大小图标改为可以无级调节的Scale属性，并支持了定死大小的图标

为所有的视图添加了ToolTip

对工具类进行了分离

在获取缩略图时，将显示小小的圈圈转啊转

修复和优化了一些小问题

修复了不把鼠标点在图片上就没法拖放文件的BUG

新增右键菜单复制功能

## 20200718

新增根据目录分组显示功能

修复了根据目录进行定位/定位文件不可用的BUG

新增排序功能

新增日志功能

新增关于

修改了主界面的分类和文件区域的布局，从Expander变为GridSplitter，支持点一下收回和弹出

修改了部分布局

至此，程序功能的编写基本结束

------

## 2020719

对许多一个文件多个类的进行了重新分类

将尺寸相关属性全部改为静态属性，然后使用静态绑定

再次修改了图片尺寸绑定方式，将交给ViewBox进行缩放

## 20200720

新增显示没有被归类的文件的功能

## 20200722

修复了在切换项目和页面的时候，会重复创建页面实例导致性能降低的BUG

优化显示没有被分类的文件时，会排除已经被手动分类的文件夹内的文件

修复了树状图下，根目录会被单独列出一个文件夹的BUG

新增右键菜单的显示文件属性的功能

分离了Win32API

新增了可以将文件拖放到分类列表项上以添加文件到类中的功能

新增新增文件时自动确认（记忆）功能

新增了树状图的拖放

修复了拖放两次中有一次会失败的BUG

支持了树状图的选择

## 20200723

当文件从树状图中删除时，视图中会同步删除

当显示没有被分类的文件、文件从树状图中移除时，视图中会同步删除

修复了显示全部文件时会显示自己拖进去的文件夹的BUG

修复了更新文件时会认为所有文件夹都是不存在的文件从而被删除的BUG

完成了系统的FilesViewer中所有视图的选择事件，当新增文件时，将会选择到新增的文件

提升了TagGroup的视觉效果

将三大Panel换成了Page，并新增了页面间切换动画

优化了资源管理器图标的存储方式，同一个扩展名将只会存储一个图标

修复了树状图在空白处拖放报错的BUG

## 20200724

新增筛选功能 

新增独立文件查看窗口功能

新增了UIClass的视图模型

修改了分类列表的样式

修改了分类设置底栏的一些逻辑和交互

修改了日志的模型和页面，增加了详情

修复了在更新和新增文件的对话框中，无法弹出对话框的BUG

修复了无法导出树状快捷方式/文件的BUG

新增删除所有FileClasses的功能

## 20200725

优化了对文件分类的获取，在获取文件时将使用左连接一并获取文件的分类

完全修改了数据库工具类，完全使用同步取代了异步查询，转而使用时用Task.Run执行。初步测试没有大问题。

## 20200726

新增修复孤立缩略图的功能

优化了切换Project和Class时的UI响应

修复了树形结构文件夹没有Parent的BUG

树状图也有虚拟化了

新增按Ctrl+D取消选择功能

新增支持开启文件写入/创建时间的显示

减小了图标视图下图标边距

## 20200727

优化了视图滚动，支持平滑滚动的滚动视图

调整了平铺视图的样式，限制了路径长度

修复了光标在空白区域不会弹出ToolTip的Bug

修复了光标在Item之间移动的时候ToolTip有几率会显示同一张图的BUG

新增将缩略图存放到临时目录的功能

## 20200728

使ToolTip的图片使用两级加载

对界面的布局、颜色做了大量调整

修复了从分类、项目设置界面离开到其他界面会有延迟的BUG

## 20200729

新增将图标裁剪为正方形显示的功能

新增简单树状图视图

修复了更新文件时会删除手动添加的文件的BUG

当新建分类时，将自动打开重命名框

当正在加入文件时，将显示Loading

新增分类排序功能

## 20200730

新增文件名显示格式功能，并新增三个附加属性（重磅功能，写了6个小时）

新增查看Exif表格功能

## 20200731

修改Exif表格功能为查看文件元数据

新增平滑滚动开关

为昨天的更新扫了尾

格式化脚本新增C#语言支持

修复了多个任务可能因为同时请求而同时进行导致性能问题的BUG

优化了分类设置界面的速度，取消了设置界面的各种数据库保存，仅在离开时保存

新增Debug开关

## 20200801

加快了获取某一类的文件的速度

修复了主窗体关闭后可能有进程残留的BUG

修复了图标视图缩小时回往一边斜的BUG

## 20200802

新增分类分组功能

修改除树状图以外的视图，将弹出菜单功能附加到Item上

## 20200803

修改了一些小细节

修改了一些数据库结构

左下角修改为“更多”按钮，并增加了两个按钮

## 20200804

新增使用Win10API获取图标的功能

尝试支持了WindowsApp包

## 20200805

补充了文本格式帮助

简易格式的格式符支持了Exif数字

删除了PowerShell支持

加快了启动界面显示的速度

## 20200806

修复了转圈圈的时候如果报错，圈圈会一直转下去的BUG

修复了无法同时显示两个对话框导致抛出异常的BUG（然而异常也是由对话框弹出的，之前可能会直接死循环）

## 20200808

新增了主界面标题栏单行布局

新增了第一次启动时会询问是否生成示例数据

微调了平滑滚动的算法

增加平滑缩放（Ctrl+滚轮）功能

## 2020809

时隔长达1！天！以后，布局又被我改掉了，改成了左中右三栏纵向布局

修复了用Ctrl+滚轮缩放后，显示面板的Slider和文字不会变的BUG

修复了平铺视图下不显示目录名时，文件名显示位置仍然很少、没有居中的BUG

修复了分类标签排序不确定层次不齐的BUG

尝试加快了缩略图显示速度，取消了页面虚拟化缓存

修复了默认没有按文件夹排序的BUG

## 20200810

新增了左侧菜单栏最小化显示的功能

新增可以设置是否将数据库放置到系统程序数据目录下（缓存数据将同步）

允许枚举文件时根目录下存在不可访问的文件，当存在时将自动跳过

FileTree将会延迟加载，只有当显示树状图时才会加载

修复了以下BUG：先点A项目的x类，然后点B项目，虽然选中了第一个类但是没有显示内容，点击刷新刷新出来的是x类的内容

## 20200811

UIFileDisplay部分属性将延迟初始化，几乎解决了文件及将显示之前的卡顿

修改了项目列表布局，并增加了直接删除项目的功能

新增流畅度优先模式

修复了利用C#语言描述文字格式的内存泄漏问题

优化显示，重复利用虚拟化控件提高性能

## 20200812

修复了无法导出文件的BUG

删除了项目设置界面的删除缩略图功能，移动到设置窗体中

进行了流畅度优化

## 20200813

修改了缩略图的索引方式，改用文件的ID号索引

修改了Win10缩略图的保存格式，当发现不是透明色图时，使用Jpg保存

新增退出程序时删除缩略图的功能

## 20200814

修改了任务队列的方式

优化了流畅度（修改部分优先级、修改了虚拟化面板缓存、修改了图片解码分辨率）

## 20200815

删除了不必要的Task.Delay

支持了设置是否在处理任务时显示圈圈

修改了设置界面，合并了日志界面

## 20200816

再次修改了任务队列的方式，提高了效率、防止了任务队列执行时卡死UI

## 20200824

修复了当没有任何类时，在显示全部文件时右键菜单会崩溃的BUG

新增支持删除物理文件功能

## 20200827

新增从类中移除的功能

修复了有些菜单不会出现的BUG

修复了分类速度慢的BUG