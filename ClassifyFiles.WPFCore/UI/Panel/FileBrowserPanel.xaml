<panel:ProjectPanelBase
    xmlns:panel="clr-namespace:ClassifyFiles.UI.Panel"
    xmlns:ui="clr-namespace:ClassifyFiles.UI"
    x:Class="ClassifyFiles.UI.Panel.FileBrowserPanel"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:ClassifyFiles.UI"
    xmlns:data="clr-namespace:ClassifyFiles.Data;assembly=ClassifyFiles.Core"
    xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes" xmlns:component="clr-namespace:ClassifyFiles.UI.Component"
    Loaded="WindowBase_Loaded"
        mc:Ignorable="d"    >
    <UserControl.Resources>
        <ui:NotFirst2VisibilityConverter x:Key="i2v"/>
        <ui:IsNotNull2BoolConverter x:Key="nn2b"/>
    </UserControl.Resources>
    <Grid Margin="4">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="8"/>
            <ColumnDefinition Width="2*"/>
        </Grid.ColumnDefinitions>
        
        <Grid Margin="8,0,0,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="4"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="8"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <Grid Margin="4">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="8"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="8"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Text="{Binding Project.Name}"   VerticalAlignment="Center"  FontSize="24"/>

                <TextBox Grid.Column="2"
  materialDesign:HintAssist.Hint="项目根目录"
  Style="{StaticResource MaterialDesignFloatingHintTextBox}"
  VerticalAlignment="Center" Text="{Binding Project.RootPath}"/>
                <materialDesign:PopupBox  Grid.Column="4"   VerticalAlignment="Center"    HorizontalAlignment="Right"        Padding="2 0 2 0">
                    <StackPanel>
                        <Button  Content="重命名" />
                        <Button  Content="删除"/>
                    </StackPanel>
                </materialDesign:PopupBox>
            </Grid>
            <panel:ClassesPanel x:Name="classes" Grid.Row="99" Editable="False" SelectedClassChanged="classes_SelectedClassChanged"/>
        </Grid>


        <Grid Margin="4" Grid.Column="2" PreviewMouseWheel="ListBox_PreviewMouseWheel" >
            <Grid.Resources>
                <ContextMenu x:Key="menu">
                    <MenuItem Header="打开目录" Click="OpenDirMernuItem_Click"/>
                </ContextMenu>
            </Grid.Resources>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="4"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <DockPanel HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Height="32">
                <StackPanel DockPanel.Dock="Left" Orientation="Horizontal">
                    <Button    Style="{StaticResource MaterialDesignFlatButton}" Click="RefreshAllButton_Click">刷新所有</Button>
                    <Button    Style="{StaticResource MaterialDesignFlatButton}"          IsEnabled="{Binding ElementName=classes, Path=SelectedClass, Converter={StaticResource nn2b}}">刷新此类</Button>
                </StackPanel>
                <!-- the following based on https://material.io/guidelines/components/buttons.html#buttons-toggle-buttons -->
                <ListBox x:Name="lbxDisplayMode" DockPanel.Dock="Right" HorizontalAlignment="Right"  SelectionChanged="ListBox_SelectionChanged"
                         Style="{StaticResource MaterialDesignToolToggleListBox}"  SelectedIndex="0"
                          IsEnabled="{Binding ElementName=classes, Path=SelectedClass, Converter={StaticResource nn2b}}">
                    <ListBoxItem >
                        <materialDesign:PackIcon    Kind="FormatListBulleted" />
                    </ListBoxItem>
                    <ListBoxItem>
                        <materialDesign:PackIcon      Kind="ViewComfy" />
                    </ListBoxItem>     <ListBoxItem>
                        <materialDesign:PackIcon      Kind="FileTree" />
                    </ListBoxItem>
                </ListBox>
            </DockPanel>
            <Grid Grid.Row="2"  IsEnabled="{Binding ElementName=classes, Path=SelectedClass, Converter={StaticResource nn2b}}"
                        Visibility="Collapsed" x:Name="grdFilesArea">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="8"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <ListBox DockPanel.Dock="Top" 
                         x:Name="lbxGrdFiles" ContextMenu="{StaticResource menu}"
                      PreviewMouseDoubleClick="lvwFiles_PreviewMouseDoubleClick"
                         Style="{StaticResource MaterialDesignGridList}" ItemsSource="{Binding Path=PagingFiles}">
                    <ListBox.ItemTemplate>
                        <DataTemplate >
                            <Border HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Padding="2">
                                <DockPanel HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
                                       ToolTip="{Binding Dir, Mode=OneTime}">
                                    <TextBlock DockPanel.Dock="Bottom" FontSize="12" Text="{Binding Path=Name, Mode=OneTime}"
                               Margin="0,8,0,0" HorizontalAlignment="Center" TextWrapping="Wrap" MaxHeight="32" MaxWidth="{Binding LargeIconSize}"/>
                                    <component:FileIcon File="{Binding .}" UseLargeIcon="True"/>
                                </DockPanel>
                            </Border>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
                <ScrollViewer x:Name="scrPagging" Grid.Row="2"  VerticalScrollBarVisibility="Disabled" HorizontalScrollBarVisibility="Hidden" PreviewMouseWheel="ScrollViewer_PreviewMouseWheel">
                    <StackPanel x:Name="stkPagging" Orientation="Horizontal"/>
                </ScrollViewer>
            </Grid>
            <!--<ListView Grid.Row="2"  ItemsSource="{Binding Files}" x:Name="lvwFiles" 
                      PreviewMouseDoubleClick="lvwFiles_PreviewMouseDoubleClick"  ContextMenu="{StaticResource menu}"
                      IsEnabled="{Binding ElementName=classes, Path=SelectedClass, Converter={StaticResource nn2b}}">
                <ListView.View>
                    <GridView>
                        <GridViewColumn Width="48">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <component:FileIcon File="{Binding .}"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>
                        <GridViewColumn Header="文件名" DisplayMemberBinding="{Binding Name}" />
                        <GridViewColumn Header="目录" DisplayMemberBinding="{Binding Dir}"/>
                    </GridView>
                </ListView.View>
            </ListView>-->
            <Grid Grid.Row="2" x:Name="lvwFilesArea">
                <Grid.RowDefinitions >
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="8"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>     
                <ListView   ItemsSource="{Binding Files}" x:Name="lvwFiles" 
                      PreviewMouseDoubleClick="lvwFiles_PreviewMouseDoubleClick"  ContextMenu="{StaticResource menu}"
                      IsEnabled="{Binding ElementName=classes, Path=SelectedClass, Converter={StaticResource nn2b}}">
                <ListView.ItemTemplate>
                    <DataTemplate>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="16"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="4"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <component:FileIcon File="{Binding .}" Grid.RowSpan="99"/>
                            <TextBlock Text="{Binding Name}" Grid.Column="2" Grid.Row="0"/>
                            <TextBlock Text="{Binding Dir}" Grid.Column="2" Grid.Row="2" Opacity="0.5"/>
                        </Grid>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
                <ComboBox Grid.Row="2" materialDesign:HintAssist.Hint="跳转到目录" SelectionChanged="JumpToDirComboBox_SelectionChanged" ItemsSource="{Binding Dirs}"/>
            </Grid>
            <TreeView Name="treeFiles" Visibility="Collapsed"   ContextMenu="{StaticResource menu}" PreviewMouseRightButtonDown="treeFiles_PreviewMouseRightButtonDown"
                       IsEnabled="{Binding ElementName=classes, Path=SelectedClass, Converter={StaticResource nn2b}}"
                      Grid.Row="2"  ItemsSource="{Binding FileTree}" PreviewMouseDoubleClick="lvwFiles_PreviewMouseDoubleClick" Margin="-33,0,33,0">

                <TreeView.ItemTemplate>
                    <HierarchicalDataTemplate DataType="{x:Type panel:FileWithIcon}" ItemsSource="{Binding SubFiles}">
                        <StackPanel Orientation="Horizontal">
                            <component:FileIcon File="{Binding .}"/>
                            <TextBlock VerticalAlignment="Center" FontSize="12" Margin="12,0,0,0" Text="{Binding Name}"/>
                        </StackPanel>    
                    </HierarchicalDataTemplate>
                </TreeView.ItemTemplate>
            </TreeView>

        </Grid>

        <ui:ProgressDialog x:Name="loading" Grid.ColumnSpan="99" Margin="-100"/>
    </Grid>
</panel:ProjectPanelBase>
